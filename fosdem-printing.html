<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui"><title>Why our HTML Docs Don&#8217;t Just Print and What to Do About It</title><link rel="stylesheet" href="reveal.js/dist/reset.css"><link rel="stylesheet" href="reveal.js/dist/reveal.css"><link rel="stylesheet" href="white-course.css" id="theme"><!--This CSS is generated by the Asciidoctor reveal.js converter to further integrate AsciiDoc's existing semantic with reveal.js--><style type="text/css">.reveal div.right {
  float: right
}

/* source blocks */
.reveal .listingblock.stretch > .content {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre {
  height: 100%
}

.reveal .listingblock.stretch > .content > pre > code {
  height: 100%;
  max-height: 100%
}

/* auto-animate feature */
/* hide the scrollbar when auto-animating source blocks */
.reveal pre[data-auto-animate-target] {
  overflow: hidden;
}

.reveal pre[data-auto-animate-target] code {
  overflow: hidden;
}

/* add a min width to avoid horizontal shift on line numbers */
code.hljs .hljs-ln-line.hljs-ln-n {
  min-width: 1.25em;
}

/* tables */
table {
  border-collapse: collapse;
  border-spacing: 0
}

table {
  margin-bottom: 1.25em;
  border: solid 1px #dedede
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
  padding: .5em .625em .625em;
  font-size: inherit;
  text-align: left
}

table tr th, table tr td {
  padding: .5625em .625em;
  font-size: inherit
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
  display: table-cell;
  line-height: 1.6
}

td.tableblock > .content {
  margin-bottom: 1.25em
}

td.tableblock > .content > :last-child {
  margin-bottom: -1.25em
}

table.tableblock, th.tableblock, td.tableblock {
  border: 0 solid #dedede
}

table.grid-all > thead > tr > .tableblock, table.grid-all > tbody > tr > .tableblock {
  border-width: 0 1px 1px 0
}

table.grid-all > tfoot > tr > .tableblock {
  border-width: 1px 1px 0 0
}

table.grid-cols > * > tr > .tableblock {
  border-width: 0 1px 0 0
}

table.grid-rows > thead > tr > .tableblock, table.grid-rows > tbody > tr > .tableblock {
  border-width: 0 0 1px
}

table.grid-rows > tfoot > tr > .tableblock {
  border-width: 1px 0 0
}

table.grid-all > * > tr > .tableblock:last-child, table.grid-cols > * > tr > .tableblock:last-child {
  border-right-width: 0
}

table.grid-all > tbody > tr:last-child > .tableblock, table.grid-all > thead:last-child > tr > .tableblock, table.grid-rows > tbody > tr:last-child > .tableblock, table.grid-rows > thead:last-child > tr > .tableblock {
  border-bottom-width: 0
}

table.frame-all {
  border-width: 1px
}

table.frame-sides {
  border-width: 0 1px
}

table.frame-topbot, table.frame-ends {
  border-width: 1px 0
}

.reveal table th.halign-left, .reveal table td.halign-left {
  text-align: left
}

.reveal table th.halign-right, .reveal table td.halign-right {
  text-align: right
}

.reveal table th.halign-center, .reveal table td.halign-center {
  text-align: center
}

.reveal table th.valign-top, .reveal table td.valign-top {
  vertical-align: top
}

.reveal table th.valign-bottom, .reveal table td.valign-bottom {
  vertical-align: bottom
}

.reveal table th.valign-middle, .reveal table td.valign-middle {
  vertical-align: middle
}

table thead th, table tfoot th {
  font-weight: bold
}

tbody tr th {
  display: table-cell;
  line-height: 1.6
}

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p {
  font-weight: bold
}

thead {
  display: table-header-group
}

.reveal table.grid-none th, .reveal table.grid-none td {
  border-bottom: 0 !important
}

/* kbd macro */
kbd {
  font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace;
  display: inline-block;
  color: rgba(0, 0, 0, .8);
  font-size: .65em;
  line-height: 1.45;
  background: #f7f7f7;
  border: 1px solid #ccc;
  -webkit-border-radius: 3px;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em white inset;
  box-shadow: 0 1px 0 rgba(0, 0, 0, .2), 0 0 0 .1em #fff inset;
  margin: 0 .15em;
  padding: .2em .5em;
  vertical-align: middle;
  position: relative;
  top: -.1em;
  white-space: nowrap
}

.keyseq kbd:first-child {
  margin-left: 0
}

.keyseq kbd:last-child {
  margin-right: 0
}

/* callouts */
.conum[data-value] {
  display: inline-block;
  color: #fff !important;
  background: rgba(0, 0, 0, .8);
  -webkit-border-radius: 50%;
  border-radius: 50%;
  text-align: center;
  font-size: .75em;
  width: 1.67em;
  height: 1.67em;
  line-height: 1.67em;
  font-family: "Open Sans", "DejaVu Sans", sans-serif;
  font-style: normal;
  font-weight: bold
}

.conum[data-value] * {
  color: #fff !important
}

.conum[data-value] + b {
  display: none
}

.conum[data-value]:after {
  content: attr(data-value)
}

pre .conum[data-value] {
  position: relative;
  top: -.125em
}

b.conum * {
  color: inherit !important
}

.conum:not([data-value]):empty {
  display: none
}

/* Callout list */
.hdlist > table, .colist > table {
  border: 0;
  background: none
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
  background: none
}

td.hdlist1, td.hdlist2 {
  vertical-align: top;
  padding: 0 .625em
}

td.hdlist1 {
  font-weight: bold;
  padding-bottom: 1.25em
}

/* Disabled from Asciidoctor CSS because it caused callout list to go under the
 * source listing when .stretch is applied (see #335)
 * .literalblock+.colist,.listingblock+.colist{margin-top:-.5em} */
.colist td:not([class]):first-child {
  padding: .4em .75em 0;
  line-height: 1;
  vertical-align: top
}

.colist td:not([class]):first-child img {
  max-width: none
}

.colist td:not([class]):last-child {
  padding: .25em 0
}

/* Override Asciidoctor CSS that causes issues with reveal.js features */
.reveal .hljs table {
  border: 0
}

/* Callout list rows would have a bottom border with some reveal.js themes (see #335) */
.reveal .colist > table th, .reveal .colist > table td {
  border-bottom: 0
}

/* Fixes line height with Highlight.js source listing when linenums enabled (see #331) */
.reveal .hljs table thead tr th, .reveal .hljs table tfoot tr th, .reveal .hljs table tbody tr td, .reveal .hljs table tr td, .reveal .hljs table tfoot tr td {
  line-height: inherit
}

/* Columns layout */
.columns .slide-content {
  display: flex;
}

.columns.wrap .slide-content {
  flex-wrap: wrap;
}

.columns.is-vcentered .slide-content {
  align-items: center;
}

.columns .slide-content > .column {
  display: block;
  flex-basis: 0;
  flex-grow: 1;
  flex-shrink: 1;
}

.columns .slide-content > .column > * {
  padding: .75rem;
}

/* See #353 */
.columns.wrap .slide-content > .column {
  flex-basis: auto;
}

.columns .slide-content > .column.is-full {
  flex: none;
  width: 100%;
}

.columns .slide-content > .column.is-four-fifths {
  flex: none;
  width: 80%;
}

.columns .slide-content > .column.is-three-quarters {
  flex: none;
  width: 75%;
}

.columns .slide-content > .column.is-two-thirds {
  flex: none;
  width: 66.6666%;
}

.columns .slide-content > .column.is-three-fifths {
  flex: none;
  width: 60%;
}

.columns .slide-content > .column.is-half {
  flex: none;
  width: 50%;
}

.columns .slide-content > .column.is-two-fifths {
  flex: none;
  width: 40%;
}

.columns .slide-content > .column.is-one-third {
  flex: none;
  width: 33.3333%;
}

.columns .slide-content > .column.is-one-quarter {
  flex: none;
  width: 25%;
}

.columns .slide-content > .column.is-one-fifth {
  flex: none;
  width: 20%;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.columns .slide-content > .column.has-text-left {
  text-align: left;
}

.columns .slide-content > .column.has-text-justified {
  text-align: justify;
}

.columns .slide-content > .column.has-text-right {
  text-align: right;
}

.text-left {
  text-align: left !important
}

.text-right {
  text-align: right !important
}

.text-center {
  text-align: center !important
}

.text-justify {
  text-align: justify !important
}

.footnotes {
  border-top: 1px solid rgba(0, 0, 0, 0.2);
  padding: 0.5em 0 0 0;
  font-size: 0.65em;
  margin-top: 4em;
}

.byline {
  font-size:.8em
}
ul.byline {
  list-style-type: none;
}
ul.byline li + li {
  margin-top: 0.25em;
}
</style></head><body><div class="reveal"><div class="slides"><section class="title" data-state="title"><h1>Why our HTML Docs Don&#8217;t Just <code>Print</code> and What to Do About It</h1><div class="preamble"><table class="tableblock frame-all grid-all title-footer" style="width:100%"><colgroup><col style="width:15.4761%"><col style="width:65.4761%"><col style="width:19.0478%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="imageblock title-photo"><img src="images/nmp1.jpg" alt="nmp1"></div></div></td><td class="tableblock halign-left valign-top"><div><div class="paragraph full-name"><p>Nikolaj Potashnikov</p></div>
<div class="paragraph bio"><p>PhD in Economics, Solution architect, Course-IT</p></div></div></td><td class="tableblock halign-right valign-bottom" rowspan="2"><div><div class="paragraph"><p>&#160;</p></div>
<div class="imageblock logo"><img src="images/fosdem-logo.svg" alt="fosdem logo"></div></div></td></tr><tr><td class="tableblock halign-left valign-top" colspan="2"><div><div class="paragraph contact"><p><span class="icon">[envelope&#93;</span> <a href="mailto:consulting@yandex.ru">consulting@yandex.ru</a> <span class="icon">[telegram&#93;</span>&#160;@nmpotashnikoff</p></div></div></td></tr></table>
<aside class="notes"><div class="ulist"><ul><li><p>As a solution architect, I need to create targeted docs for each stakeholder.
What is the easiest way to share them?
Via email, a messenger&#8230;&#8203; as a PDF, a Word file.
In short, in a print format</p></li><li><p>[REF] Why this epigraph?</p><div class="ulist"><ul><li><p>It’s FOSDEM, and Liszt was one of the most free spirited composers — and perhaps people</p></li><li><p>Value is in the result; tools shouldn’t limit freedom in getting the result we need to get</p></li><li><p>A conductor should get the maximum out of the capabilities he has in the orchestra, so should we, no matter what constraints we&#8217;ve got on the side of input markup, output format, rendering technology</p></li></ul></div></li></ul></div></aside></div></section>
<section id="a400"><div class="slide-content"><div class="quoteblock"><blockquote>The principal task of a conductor is not to&#160;put himself in&#160;evidence but to&#160;disappear behind his&#160;functions</blockquote><div class="attribution">&#8212; Liszt Ferenc</div></div></div></section>
<section id="a1"><h2>2. <code>Print</code>, <code>Export to Word</code>, <code>Export to PDF</code> are very often just a trap</h2><div class="slide-content"><div class="ulist"><div class="title">What to do with a long line in a listing?</div><ul><li class="fragment"><p>We may scale</p></li><li class="fragment"><p>Or use landscape orientation</p></li><li class="fragment"><p>Or both, but would it be enough?</p></li><li class="fragment"><p>If not, we may fire error for long lines or wrap them</p></li><li class="fragment"><p>With linefeed and spaces?
And how to copy?</p></li><li class="fragment"><p>With indents?
Still impossible to copy from PDF</p></li><li class="fragment"><p>And on the web we can just add horizontal scroll bar.</p></li></ul></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content">There is a core mismatch: semantic markup meets the rigid world of print</td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>Take a simple listing&#8230;&#8203; (go through very briefly just to give filling)</p><div class="ulist"><ul><li><p>Stop on orientation&#8201;&#8212;&#8201;it is already not about semantic markup. Landscape for listing, for section, for higher level section?
Should tech writer use media hints?</p></li></ul></div></li><li><p>The goal of this talk is to show an approach to tackling such problems</p></li><li><p>This talk is aimed at engineers who automate documentation and need reliable print output</p></li></ul></div></aside></div></section>
<section id="a300"><h2>3. Iterations in converting simple text markup to print formats</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://github.com/CourseOrchestra/course-doc" class="bare">https://github.com/CourseOrchestra/course-doc</a>: XSL-FO templates for Asciidoctor &#8594; DocBook backend</p></li><li><p><a href="https://github.com/CourseOrchestra/asciidoctor-open-document" class="bare">https://github.com/CourseOrchestra/asciidoctor-open-document</a>: Open Document Converter for Asciidoc</p></li><li><p><a href="https://github.com/fiddlededee/unidoc-publisher" class="bare">https://github.com/fiddlededee/unidoc-publisher</a>: UniDoc Publisher&#8201;&#8212;&#8201;any markup to any printing rendering engine</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>Today we are speaking about UniDoc Publisher approach, but we&#8217;ll look at Asciidoctor Open Document. Why, despite success an extra step was needed</p></li></ul></div></aside></div></section>
<section><section id="a17"><h2>4. Main formats for printing</h2><div class="slide-content"><div class="olist arabic"><ol class="arabic"><li class="fragment"><p>PDF</p></li><li class="fragment"><p>Text processing formats (Open XML&#8201;&#8212;&#8201;MS Office, Open Document&#8201;&#8212;&#8201;LibreOffice)</p></li><li class="fragment"><p>HTML?</p></li></ol></div><div class="admonitionblock tip fragment"><table><tr><td class="icon"><div class="title">Tip</div></td><td class="content">CSS Paged Media&#8201;&#8212;&#8201;CSS extension, defining style specific for printing</td></tr></table></div><aside class="notes"><div class="ulist"><ul><li><p>Despite we live with Paged Media CSS for almost 15 years, HTML&#8201;&#8212;&#8201;still poor browser support, usually used via PDF. HTML for printing is an intermediary format. There are great open-source solutions to convert it to PDF&#8201;&#8212;&#8201;WeasyPrint and a number of a great non-open-source solutions. But still HTML is an intermediary format</p></li><li><p>[REF] If somebody is interested, probably the most well-known are Antenna Publisher, Oxygen</p></li></ul></div></aside></div></section><section id="a2"><h2>4.1. Most widespread rendering approaches</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>PDF &#8592; native PDF-generating libraries</p></li><li class="fragment"><p>PDF &#8592; XSL-FO with FOP-processors</p></li><li class="fragment"><p>PDF &#8592; via TeX</p></li><li class="fragment"><p>PDF &#8592; HTML + Paged Media CSS</p></li><li class="fragment"><p>DOCX/ODT, PDF &#8592; +/- text processors (MS Word, LO Writer)</p></li></ul></div>
<div class="admonitionblock warning fragment"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>These technologies are not aligned in a great number of details like:</p></div>
<div class="ulist"><ul><li><p>Apache FOP has problems with Leader alignment (dots in a table of contents)</p></li><li><p>LO Writer doesn&#8217;t support typography (like keep with next) within table cells</p></li><li><p>Microsoft doesn&#8217;t recommend running automation tasks (like saving PDF) on a server</p></li></ul></div></td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>There are others, but these cover most cases</p></li><li><p>[REF] Native libraries examples: ReportLab in Python, Prawn in Ruby, PDFBox in Java</p></li><li><p>[REF] You can see Leader Problems in UniDoc Publisher documentation</p></li><li><p>[REF] <a href="https://support.microsoft.com/en-us/topic/considerations-for-server-side-automation-of-office-48bcfe93-8a89-47f1-0bce-017433ad79e2" class="bare">https://support.microsoft.com/en-us/topic/considerations-for-server-side-automation-of-office-48bcfe93-8a89-47f1-0bce-017433ad79e2</a></p></li></ul></div></aside></div></section></section>
<section id="_some_brief_conclusions"><h2>5. Some brief conclusions</h2><div class="slide-content"><div class="admonitionblock warning fragment"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="paragraph"><p>Feel like speleologist?</p></div></td></tr></table></div>
<div class="openblock fragment"><div class="content"><div class="ulist"><ul><li class="fragment"><p>The world of printing is the world of constraints</p></li><li class="fragment"><p>And those constraints differ for each technology, you often need to support several chains (exquisitely looking PDF with TeX and LibreOffice for coordination)</p></li><li class="fragment"><p>With no universal solutions</p></li></ul></div></div></div>
<aside class="notes"><div class="paragraph"><p>Two speleologists meet in a narrow tunnel.
I&#8217;m from a dead end.
I&#8217;m too!</p></div>
<div class="ulist"><ul><li><p>Documentation of UniDoc Publisher is created with Asciidoctor and published with WeasyPrint, XSL-FO and Open Document toolchains. Looks pretty the same. But just as a proof of concept</p></li></ul></div></aside></div></section>
<section id="a50"><h2>6. UniDoc Publisher approach suits best if at least <code>one of</code></h2><div class="slide-content"><div class="ulist"><ul><li><p>You don&#8217;t prepare documentation especially for printing purposes</p></li><li><p>You are automating documentation generation and hope it will look good, no matter what will be generated</p></li><li><p>Your output format is one of the text processing format</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>First point is usually true if inputs&#8201;&#8212;&#8201;Simple markup/Wiki, main means of publication&#8201;&#8212;&#8201;HTML or static site</p></li></ul></div></aside></div></section>
<section><section id="a9"><h2>7. In search for flexibility: Asciidoctor open document</h2><div class="slide-content"><div class="openblock"><div class="title">Automation on the writer side</div><div class="content"><div class="olist arabic"><ol class="arabic"><li class="fragment"><p>Asciidoctor parses markup into AST (Abstract Syntax Tree)</p></li><li class="fragment"><p>You may transform AST with Asciidoctor AST processing</p></li><li class="fragment"><p>Asciidoctor runs writer template for each AST node recursively</p></li><li class="fragment"><p>You may write your code in pure Ruby or with special Slim templates</p></li></ol></div></div></div><aside class="notes"><div class="ulist"><ul><li><p>First idea was to follow Asciidoctor ways, and these proved to be working ways</p></li></ul></div></aside></div></section><section id="a301"><h2>7.1. A simplified processing AST example</h2><div class="slide-content"><table class="tableblock frame-all grid-all" style="width:100%"><colgroup><col style="width:40%"><col style="width:60%"></colgroup><tbody><tr><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-yaml" data-lang="yaml">- !&lt;OrderedList&gt;
  roles:
  - "arabic"
  id: "ol-1"
  captioned_title:
      children:
      - !&lt;Text&gt;
        text: "Automation"
  children:
  - !&lt;ListItem&gt;
    children:
    - !&lt;Paragraph&gt;
      children:
      - !&lt;Text&gt;
        text: "Asciidoctor..."
  - !&lt;ListItem&gt;
...</code></pre></div></div></div></td><td class="tableblock halign-left valign-top"><div><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-slim" data-lang="slim">- list_style = "#{get_basic_style}"
- if captioned_title?
  text:p text:style-name="#{list_style}"
    text:bookmark text:name="#{id}"
    =captioned_title

text:list text:style-name="#{list_style}"
  - items.each_with_index do |item, index|</code></pre></div></div></div></td></tr></table>
<aside class="notes"><div class="ulist"><ul><li><p>dash means code in Ruby</p></li><li><p><code>get_basic_style</code> is some external function, defined as a helper, so Ruby can be used within template</p></li></ul></div></aside></div></section><section id="a10"><h2>7.2. Great, but</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>You can&#8217;t override part of a template</p></li><li class="fragment"><p>You should invent styling approach</p></li></ul></div>
<div class="openblock indent-before fragment"><div class="title">Styling? But text processors do support styling!</div><div class="content"><div class="admonitionblock warning"><table><tr><td class="icon"><div class="title">Warning</div></td><td class="content"><div class="ulist"><ul><li class="fragment"><p><code>&lt;span class="bold green"&gt;bold, green&lt;/span&gt;</code>&#8201;&#8212;&#8201;impossible to apply two styles to one element</p></li></ul></div></td></tr></table></div></div></div>
<div class="admonitionblock tip fragment"><table><tr><td class="icon"><div class="title">Tip</div></td><td class="content"><div class="ulist"><ul><li><p>Asciidoctor Open Document introduces some extended Open Document format to preserve Asciidoctor AST contents</p></li><li><p>Each function checks, if style should be applied, and if yes, applies it in a more or less OpenDocument way: it doesn&#8217;t understand styling attributes but forces the structure of a style</p></li></ul></div></td></tr></table></div>
<aside class="notes"><div class="ulist"><ul><li><p>In text processors we can&#8217;t apply two styles, so we can&#8217;t leave styling to text processor template</p></li><li><p>This extended format resembles AST itself</p></li></ul></div></aside></div></section><section id="a11"><h2>7.3. And still</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Unexpectedly transforming this extended Open Document format became one of the most used features of Asciidoctor Open Document</p></li><li class="fragment"><p>Styling as separate task of writing proved also to be useful</p></li><li class="fragment"><p>Gradle was magnificent in gluing all parts together</p></li></ul></div>
<aside class="notes"><div class="ulist"><ul><li><p>But obviously while we should transform AST directly, not it&#8217;s XML representation. Pandoc clearly showed that transforming AST is very convenient. It turned out to be much more useful than expected, especially if we are dealing with print output without CSS</p></li><li><p>It is important not to output raw templates, but override only styling part</p></li><li><p>Although Asciidoctor Open Document is glued with Docker, my experiments showed, that gluing with Gradle is much more controllable. Yes, finally it would be docker, but at the very end</p></li></ul></div>
<div class="admonitionblock tip"><table><tr><td class="icon"><div class="title">Tip</div></td><td class="content">At this point, it became clear that the approach could be improved at an architectural level</td></tr></table></div></aside></div></section></section>
<section id="a12"><h2>8. Thoughts before the second step</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>If creating universal converter is impossible&#8230;&#8203;</p></li><li class="fragment"><p>We should create <strong>meta converter</strong>&#8201;&#8212;&#8201;platform for building converters</p></li></ul></div>
<div class="openblock indent-before fragment"><div class="title">Estimated requirements</div><div class="content"><div class="ulist"><ul><li class="fragment"><p>Native converter as a reader</p></li><li class="fragment"><p>Sound ways of transforming AST</p></li><li class="fragment"><p>A good approach for styling as a separate focus</p></li><li class="fragment"><p>99% generic writer</p></li><li class="fragment"><p>Good integration with CI/CD with a focus on homogeneity</p></li></ul></div></div></div>
<aside class="notes"><div class="paragraph"><p>Close to Pandoc but with a focus on native converter, style overriding and CI/CD homogeneity</p></div></aside></div></section>
<section id="a200"><h2>9. Native converter as a reader?</h2><div class="slide-content"><div class="admonitionblock tip fragment"><table><tr><td class="icon"><div class="title">Tip</div></td><td class="content">Each converter outputs HTML.
HTML is quite semantic, why shouldn&#8217;t we use it?</td></tr></table></div></div></section>
<section id="a105"><h2>10. Let&#8217;s convert this presentation to LO Writer</h2><div class="slide-content"><div class="imageblock"><img src="images/slide-1-to-print.png" alt="slide 1 to print" width="65%"></div>
<aside class="notes"><div class="paragraph"><p>This presentation is created with Asciidoctor Reveal.js, so we can convert it to document with notes</p></div></aside></div></section>
<section id="a306"><h2>11. Notes on this demo</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Everything is in a single Gradle script (<code>build.gradle.kts</code>)</p></li><li class="fragment"><p>All Kotlin code examples are just includes from this script</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Instead of Gradle script it can be just an ordinary Java/Kotlin project, with a CLI or even service utility as an output</p></div></aside></div></section>
<section id="a106"><h2>12. Boilerplate</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]
                // Processing AST
link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="ulist"><ul><li><p>Asciidoctor is a part of a Gradle build</p></li><li><p>The project starts not from Asciidoctor HTML, but from Reveal.js Asciidoctor HTML to make notes contents closer to slides and as a proof of concept. The technology has a safety margin against any HTML: Asciidoc HTML, Asciidoc Reveal.js HTML, MD, Wiki, ReST&#8230;&#8203;</p></li><li><p>The boilerplate is quite minimalistic</p></li></ul></div></aside></div></section>
<section id="a107"><h2>13. Processing AST</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Typical AST transforming code. Typed, navigable, and testable</p></div>
<div class="paragraph"><p>Here we find section with H1 heading (title slide), and insert before it the transformed version, then remove old version</p></div></aside></div></section>
<section id="a108"><h2>14. Rearranging title (Asciidoc source)</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-asciidoc" data-lang="asciidoc">link:fosdem-printing.adoc[role=include]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>All elements have roles</p></div></aside></div></section>
<section id="a109"><h2>15. Rearranging title, extracting semantics</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Looks like XPath but once again typed, navigable, and testable</p></div></aside></div></section>
<section id="a110"><h2>16. Rearranging title, constructing title</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Rearranging looks like Slim (or XSLT) templates. Not so slim as Slim, but definitely slimmer than XSLT</p></div></aside></div></section>
<section id="a309"><h2>17. Let&#8217;s return to the result</h2><div class="slide-content"><div class="imageblock"><img src="images/slide-1-to-print.png" alt="slide 1 to print" width="55%"></div>
<aside class="notes"><div class="paragraph"><p>An epigraph appeared from the second slide. You may look at <code>build.gradle.kts</code> and find out how. But it is a very common task when we render printing version of a document</p></div></aside></div></section>
<section id="a201"><h2>18. And a little bit of styling</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="paragraph"><p>Programmable, but overrides only styling. As mentioned before UniDoc Publisher doesn&#8217;t know about styling attributes, but it ensures the structure of a style</p></div></aside></div></section>
<section id="a112"><h2>19. Let&#8217;s return to processing AST</h2><div class="slide-content"><div class="listingblock"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div>
<aside class="notes"><div class="colist arabic"><ol><li><p>Inserting horizontal lines before notes</p></li><li><p>Preventing slide from breaking</p></li><li><p>Applying custom style and rouge code highlighting styles</p></li></ol></div>
<div class="paragraph"><p>Rouge styles are generated automatically from rouge.css. The code is in <code>build.gradle.kts</code>&#8201;&#8212;&#8201;just about 20 lines. Using CSS for each rendering technology is really useful in many cases</p></div></aside></div></section>
<section><section id="a113"><h2>20. Extending AST</h2><div class="slide-content"><div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div><div class="listingblock fragment"><div class="content"><pre class="highlight"><code class="language-kotlin" data-lang="kotlin">link:build.gradle.kts[role=include]</code></pre></div></div><aside class="notes"><div class="ulist"><ul><li><p>Extending AST is quite simple. But it is rarely used. This is artificial example, easier solution would be to add paragraph directly</p></li><li><p>The same approach lets us completely override template, but once again it is rarely used. Only if some bug in UniDoc publisher writer is found, but we don&#8217;t want to wait for a fix</p></li></ul></div></aside></div></section><section id="a14"><h2>20.1. Testing</h2><div class="slide-content"><div class="imageblock"><img src="images/approval.png" alt="approval" width="100%"></div>
<aside class="notes"><div class="paragraph"><p>If we have Asciidoctor with some Printing converter platform on top and Converter on top, we should be sure, that minor changes won&#8217;t break anything</p></div>
<div class="paragraph"><p>I use the system of snippets, render them into PNG and compare by pixels with reference.
Almost 100% guarantee.</p></div>
<div class="paragraph"><p>By the way, these snippets can be put into documentation. These are real cases of usage.</p></div></aside></div></section></section>
<section id="_focus_and_trade_offs"><h2>21. Focus and trade-offs</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>CI friendly&#8201;&#8212;&#8201;pure Gradle (or an ordinary Kotlin project) to rule them all</p></li><li class="fragment"><p>No declarations, everything should be programmed</p></li><li class="fragment"><p>Typed AST&#8201;&#8212;&#8201;check before run</p></li><li class="fragment"><p>Clean and testable code</p></li><li class="fragment"><p>One AST and one styling approach, but different styling typed API for each backend</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Once again about focus and trade-offs, but after the demo</p></div>
<div class="ulist"><ul><li><p>Gradle + Kotlin stack is just a coincidence, where syntax, wide ecosystem and CI accidentally met</p></li><li><p>Still more coincidence&#8201;&#8212;&#8201;they met Asciidoctor</p></li><li><p>Still more coincidence&#8201;&#8212;&#8201;they met LibreOffice API</p></li><li><p>Too much coincidence for coincidence?</p></li></ul></div></aside></div></section>
<section id="_conclusion"><h2>22. Conclusion</h2><div class="slide-content"><div class="ulist"><ul><li class="fragment"><p>Treat printing as engineering: design it, test it, automate it</p></li><li class="fragment"><p>Printing is a lossy transformation — some semantics cannot survive it</p></li><li class="fragment"><p>Keep rendering logic programmable and under your control</p></li></ul></div></div></section>
<section id="_questions"><h2>23. Questions?</h2><div class="slide-content"><div class="ulist"><ul><li><p><a href="https://github.com/fiddlededee/unidoc-publisher" class="bare">https://github.com/fiddlededee/unidoc-publisher</a>: UniDoc Publisher&#8201;&#8212;&#8201;any markup to any printing rendering engine</p></li><li><p><a href="https://github.com/fiddlededee/fosdem-printing/tree/main" class="bare">https://github.com/fiddlededee/fosdem-printing/tree/main</a>: this presentation repository</p></li></ul></div></div></section></div></div><script src="reveal.js/dist/reveal.js"></script><script>Array.prototype.slice.call(document.querySelectorAll('.slides section')).forEach(function(slide) {
  if (slide.getAttribute('data-background-color')) return;
  // user needs to explicitly say he wants CSS color to override otherwise we might break custom css or theme (#226)
  if (!(slide.classList.contains('canvas') || slide.classList.contains('background'))) return;
  var bgColor = getComputedStyle(slide).backgroundColor;
  if (bgColor !== 'rgba(0, 0, 0, 0)' && bgColor !== 'transparent') {
    slide.setAttribute('data-background-color', bgColor);
    slide.style.backgroundColor = 'transparent';
  }
});

// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
  // Display presentation control arrows
  controls: true,
  // Help the user learn the controls by providing hints, for example by
  // bouncing the down arrow when they first encounter a vertical slide
  controlsTutorial: true,
  // Determines where controls appear, "edges" or "bottom-right"
  controlsLayout: 'bottom-right',
  // Visibility rule for backwards navigation arrows; "faded", "hidden"
  // or "visible"
  controlsBackArrows: 'faded',
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Control which views the slide number displays on
  showSlideNumber: 'all',
  // Add the current slide number to the URL hash so that reloading the
  // page/copying the URL will return you to the same slide
  hash: false,
  // Push each slide change to the browser history. Implies `hash: true`
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Disables the default reveal.js slide layout so that you can use custom CSS layout
  disableLayout: false,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // See https://github.com/hakimel/reveal.js/#navigation-mode
  navigationMode: 'default',
  // Randomizes the order of slides each time the presentation loads
  shuffle: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags whether to include the current fragment in the URL,
  // so that reloading brings you to the same fragment position
  fragmentInURL: false,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Flags if we should show a help overlay when the questionmark
  // key is pressed
  help: true,
  // Flags if speaker notes should be visible to all viewers
  showNotes: false,
  // Global override for autolaying embedded media (video/audio/iframe)
  // - null: Media will only autoplay if data-autoplay is present
  // - true: All media will autoplay, regardless of individual setting
  // - false: No media will autoplay, regardless of individual setting
  autoPlayMedia: null,
  // Global override for preloading lazy-loaded iframes
  // - null: Iframes with data-src AND data-preload will be loaded when within
  //   the viewDistance, iframes with only data-src will be loaded when visible
  // - true: All iframes with data-src will be loaded when within the viewDistance
  // - false: All iframes with data-src will be loaded only when visible
  preloadIframes: null,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Use this method for navigation when auto-sliding
  autoSlideMethod: Reveal.navigateNext,
  // Specify the average time in seconds that you think you will spend
  // presenting each slide. This is used to show a pacing timer in the
  // speaker view
  defaultTiming: 120,
  // Specify the total time in seconds that is available to
  // present.  If this is set to a nonzero value, the pacing
  // timer will work out the time available for each slide,
  // instead of using the defaultTiming value
  totalTime: 0,
  // Specify the minimum amount of time you want to allot to
  // each slide, if using the totalTime calculation method.  If
  // the automated time allocation causes slide pacing to fall
  // below this threshold, then you will see an alert in the
  // speaker notes window
  minimumTimePerSlide: 0,
  // Enable slide navigation via mouse wheel
  mouseWheel: true,
  // Hide cursor if inactive
  hideInactiveCursor: true,
  // Time before the cursor is hidden (in ms)
  hideCursorTime: 5000,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  // Add `data-preview-link` and `data-preview-link="false"` to customise each link
  // individually
  previewLinks: false,
  // Transition style (e.g., none, fade, slide, convex, concave, zoom)
  transition: 'none',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., none, fade, slide, convex, concave, zoom)
  backgroundTransition: 'fade',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Number of slides away from the current that are visible on mobile
  // devices. It is advisable to set this to a lower number than
  // viewDistance in order to save resources.
  mobileViewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Number of pixels to move the parallax background per slide
  // - Calculated automatically unless specified
  // - Set to 0 to disable movement along an axis
  parallaxBackgroundHorizontal: null,
  parallaxBackgroundVertical: null,
  // The display mode that will be used to show slides
  display: 'block',

  // The "normal" size of the presentation, aspect ratio will be preserved
  // when the presentation is scaled to fit different resolutions. Can be
  // specified using percentage units.
  width: 1600,
  height: 900,

  // Factor of the display size that should remain empty around the content
  margin: 0.1,

  // Bounds for smallest/largest possible scale to apply to content
  minScale: 0.2,
  maxScale: 1.5,

  // PDF Export Options
  // Put each fragment on a separate page
  pdfSeparateFragments: true,
  // For slides that do not fit on a page, max number of pages
  pdfMaxPagesPerSlide: 1,

  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/plugin/zoom/zoom.js', async: true, callback: function () { Reveal.registerPlugin(RevealZoom) } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, callback: function () { Reveal.registerPlugin(RevealNotes) } }
  ],
});</script><script>var dom = {};
dom.slides = document.querySelector('.reveal .slides');

function getRemainingHeight(element, slideElement, height) {
  height = height || 0;
  if (element) {
    var newHeight, oldHeight = element.style.height;
    // Change the .stretch element height to 0 in order find the height of all
    // the other elements
    element.style.height = '0px';
    // In Overview mode, the parent (.slide) height is set of 700px.
    // Restore it temporarily to its natural height.
    slideElement.style.height = 'auto';
    newHeight = height - slideElement.offsetHeight;
    // Restore the old height, just in case
    element.style.height = oldHeight + 'px';
    // Clear the parent (.slide) height. .removeProperty works in IE9+
    slideElement.style.removeProperty('height');
    return newHeight;
  }
  return height;
}

function layoutSlideContents(width, height) {
  // Handle sizing of elements with the 'stretch' class
  toArray(dom.slides.querySelectorAll('section .stretch')).forEach(function (element) {
    // Determine how much vertical space we can use
    var limit = 5; // hard limit
    var parent = element.parentNode;
    while (parent.nodeName !== 'SECTION' && limit > 0) {
      parent = parent.parentNode;
      limit--;
    }
    if (limit === 0) {
      // unable to find parent, aborting!
      return;
    }
    var remainingHeight = getRemainingHeight(element, parent, height);
    // Consider the aspect ratio of media elements
    if (/(img|video)/gi.test(element.nodeName)) {
      var nw = element.naturalWidth || element.videoWidth, nh = element.naturalHeight || element.videoHeight;
      var es = Math.min(width / nw, remainingHeight / nh);
      element.style.width = (nw * es) + 'px';
      element.style.height = (nh * es) + 'px';
    } else {
      element.style.width = width + 'px';
      element.style.height = remainingHeight + 'px';
    }
  });
}

function toArray(o) {
  return Array.prototype.slice.call(o);
}

Reveal.addEventListener('slidechanged', function () {
  layoutSlideContents(1600, 900)
});
Reveal.addEventListener('ready', function () {
  layoutSlideContents(1600, 900)
});
Reveal.addEventListener('resize', function () {
  layoutSlideContents(1600, 900)
});</script></body></html>